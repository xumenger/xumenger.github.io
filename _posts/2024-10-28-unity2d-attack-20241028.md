---
layout: post
title: Unity 横版2D 游戏开发学习笔记 - 4：实现攻击功能
categories: 游戏开发
tags: 游戏 2D 横版 攻击 碰撞器 Tag 状态机 模板设计模式 
---

>参考[【Unity 2D游戏开发教程】](https://www.bilibili.com/video/BV1sE411L7kV)整理的学习笔记，对应github 的仓库地址为[https://github.com/zs8861/2D-Platform](https://github.com/zs8861/2D-Platform)

## 动画状态机

希望达成的效果是任何动画状态都可以在玩家按下【K】之后切换到攻击动画，所以可以从【Any State】切换到【Attack】

然后Attack 结束后，需要回到上一个状态，所以Attack 需要和Idle、Run、Jump 等分别有一个连线（考虑一下切换的条件分别是什么？）

动画状态机设计如下（但是因为Attack 结束后可以回到上次的状态，所以Attack 需要和所有的动画都有一个连线，很乱）：

![](../media/image/2024-10-28/.png)

## 攻击动画和功能

先说明一下需要实现的效果，角色Attack 时，当武器挥砍出去的时候，启动Polygon Collider 2D 碰撞器，进行碰撞检测，触发相关的攻击逻辑

Polygon Collider 2D 碰撞器需要包裹住攻击时的刀这个武器，用于后续和敌人判断是否碰撞使用

大概的效果如下

![](../media/image/2024-10-28/.png)

## 设计一个敌人

在Aseprite 制作的一个蝙蝠怪，导入到Unity 之后，参考[《Unity 横版2D 游戏开发学习笔记 - 1：Unity 2D 动画基础》](https://xumenger.github.io/1-unity-2d-game-20241026/) 将其拆分，制作成动画，效果如下：

![](../media/image/2024-10-28/.gif)

## 攻击逻辑

攻击的逻辑是通过碰撞器实现的，逻辑阐述如下：

1. 如果玩家没有Attack 行为，蝙蝠的碰撞器碰到玩家的碰撞器，则玩家受伤
2. 如果玩家有Attack 行为，武器的碰撞器碰到蝙蝠的碰撞器，则蝙蝠受伤

综上，针对这个简单的攻击逻辑，涉及到三个碰撞器，以及它们之间的不同碰撞关系逻辑对应不同的业务逻辑

Enemy 上的脚本逻辑如下：

```c#

```

## 敌人抽象类

后续需要扩展不同的敌人，不同的敌人不同的攻击逻辑、属性值配置不同，所以可以基于模板设计模式抽象敌人的设计，设计一个抽象的Enemy 父类，后续不同的敌人都继承自它实现自己的个性化逻辑，有自己个性化的属性

```c#

```

现在只有一个蝙蝠敌人，可以直接继承它

```c#

```

## 遗留问题

1. 攻击时候的特效、音效、屏幕震动等还是缺失的，打击感不够
2. 有哪些增强打击感的技巧？
3. 现在的动画状态机连线看起来很乱、很复杂，应该如何优化？
4. Animator 中，Bool 变量和Trigger 变量各自的适用场景？
5. 现在的代码都是面向过程式的编程，至少对于动作部分怎么继续封装优化？
6. 武器的碰撞器在玩家按下【K】攻击时就变成enable，如果攻击有前摇呢，是否可以结果动画事件来控制enable 的时机？
7. 使用动画事件，游戏的可维护性是否不够好？是不是不够内聚
8. 攻击逻辑基于碰撞器和Tag 来实现，游戏工程越来越大，该如何规划和管理碰撞器、Tag？
9. 敌人的生命值、伤害值一般都是策划可设置的，比如不同类型的敌人配置的值是不同的
10. 设计多样、丰富的敌人有什么好的指导方法？
